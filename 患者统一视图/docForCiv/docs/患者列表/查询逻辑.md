# 查询逻辑



第一步，先收集当前用户的部门名称（**如果当前用户未配置部门，将直接报错**），并根据科室查询配置决定部门名称是否作为查询条件之一。

第二步，继续拼接输入框输入的条件（影响此处的配置有：），从solr中取出数据（查询条件可以从tomcat的运行日志中查看）。

第三步，将返回结果按solr日期配置进行时间处理。若solr中`IN_HOSPITAL_DAYS`为空，则根据出院时间和入院时间计算住院天数，否则和其他字段一样，根据患者列表表头配置填充字段展示。

第四步，根据`CIV_MEDICAL_VALUE`判断体检视图是否开启，若开启，则根据身份证号查询体检表`HDR_MEDICAL_REPORT_INFO`，根据查询结果填充“是否有体检数”字段。

